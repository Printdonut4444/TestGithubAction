name: Check Project Status

on:
  pull_request:
    types: [opened, synchronize, reopened, closed]
  workflow_dispatch: # ‡πÉ‡∏´‡πâ‡∏Å‡∏î‡∏£‡∏±‡∏ô‡πÄ‡∏≠‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÑ‡∏î‡πâ‡∏î‡πâ‡∏ß‡∏¢

jobs:
  get-status:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Echo Project Item Status
        env:
          # ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ PAT Token ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå 'project' 
          # ‡πÄ‡∏û‡∏£‡∏≤‡∏∞ GITHUB_TOKEN ‡∏õ‡∏Å‡∏ï‡∏¥‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á Project Board ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Ñ‡∏£‡∏±‡∏ö
          GH_TOKEN: ${{ secrets.MY_PROJECT_TOKEN }}
          PROJECT_NUMBER: 1  # ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏•‡∏Ç‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (‡∏î‡∏π‡∏ó‡∏µ‡πà URL)
          USER_NAME: "YOUR_GITHUB_USERNAME" # ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡∏∑‡πà‡∏≠ User ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
        run: |
          echo "üîç ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ç‡∏≠‡∏á PR #${{ github.event.pull_request.number }}..."

          # 1. ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Project Item ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö JSON
          # 2. ‡πÉ‡∏ä‡πâ jq ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ó‡∏µ‡πà‡∏°‡∏µ‡πÄ‡∏•‡∏Ç‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö PR ‡∏ô‡∏µ‡πâ
          # 3. ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏ó‡∏µ‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡πà‡∏≤ 'Status'
          
          ITEM_DATA=$(gh project item-list $PROJECT_NUMBER --owner "$USER_NAME" --format json)
          
          # ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ Status ‡∏à‡∏≤‡∏Å JSON
          STATUS=$(echo $ITEM_DATA | jq -r '.items[] | select(.content.number == ${{ github.event.pull_request.number }}) | .status')

          if [ "$STATUS" != "null" ] && [ -n "$STATUS" ]; then
            echo "=========================================="
            echo "‚úÖ ‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏ô‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô Project!"
            echo "üöÄ ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏Ñ‡∏∑‡∏≠: [ $STATUS ]"
            echo "=========================================="
          else
            echo "=========================================="
            echo "‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÉ‡∏ö‡∏ô‡∏µ‡πâ‡∏ö‡∏ô‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô Project"
            echo "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ Add PR ‡∏ô‡∏µ‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á"
            echo "=========================================="
          fi